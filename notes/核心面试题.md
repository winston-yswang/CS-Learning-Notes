## RPC

### 1、整体思路

客户端和服务器都可以访问到的通用的接口，但是只有服务器端有这个接口的实现类，客户端调用这个接口的方式，是通过网络传输，告诉服务端我要调用这个接口，服务器收到之后找到这个接口的实现类，并且执行，将执行结果返回给客户端，作为客户端调用接口方法的返回值。

### 2、最简单的实现

**1、通用接口**

定义一个两端都可以访问到的接口



**2、传输协议**

其实就是一个传输格式，服务端需要一些信息才能唯一确定服务端需要调用的接口的方法，至少包括以下：

- 接口的名字
- 方法的名字
- 方法可能被重载，所以还得传所有参数的类型
- 参数的实际值

把以上信息写到一个对象里面，传输时传输这个对象就行。即RpcRequest对象。

调用完以后需要返回客户端结果，如果调用成功了，那需要返回值，如果失败了，需要返回失败的信息，故封装成一个RpcResponse对象，包括：

1. 响应状态码
2. 响应状态的补充信息
3. 响应数据

**3、客户端实现—动态代理**

客户端因为没有接口的具体实现类，就没办法生成实例对象。这时需要用一个代理对象来完成。

采用JDK 动态代理，代理类实现 `InvocationHandler` 接口，并使用Proxy.newProxyInstance() 来生成代理对象，

`InvocationHandler`接口需要实现invoke()方法，来指明代理对象的方法被调用时的动作。在这里，就需要生成一个包含了接口、方法、参数等信息的RpcRequest 对象，发送出去，然后返回从服务端接收到的结果即可。



**4、传输过程**

先是序列化，然后通过Socket或Netty传输



**5、服务端的实现—反射调用**

使用Netty监听某个端口，如果发来了请求就建立一个线程，在新线程中处理调用。

通过class.getMethod方法，传入方法名和方法参数类型即可获得Method对象。如果你上面RpcRequest中使用String数组来存储方法参数类型的话，这里你就需要通过反射生成对应的Class数组了。通过method.invoke方法，传入对象实例和参数，即可调用并且获得返回值。







### 3、基于注解的服务自动注册和消费如何实现

**1、定义一个@Service，表示一个服务提供类，用于远程接口的实现类**

 ```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Service {

    public String name() default "";
    public String version() default "";

}
 ```

**2、再定义一个@ServiceScan，表示服务扫描的基包，并将注解加到服务端启动类上**

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface ServiceScan {

    public String value() default "";

}
```

**3、服务端启动时，进行包扫描**

首先从StackTrace（堆栈轨迹）中获取启动类的全类名

判断启动类是有@ServiceScan注解，如果没有则报错，如果有的话，则递归获取启动类所在包名所有类的Class对象；

依次取出判断是否有@Service注解，有的话就根据Class对象创建一个实例对象出来，将它的实现的接口作为服务给发布。

```java
Thread.currentThread().getStackTrace()

new Throwable().getStackTrace() 
    
Class.newInstance()
```



4、







## WebUltrasonic

产前超声AI智慧云平台是由学院与深圳市妇幼保健院为主，合作的一个AI+医疗的项目，主要是为了解决当前产前超声检查自动化程度低，检查参数受主观影响严重，高度依赖于医生的经验水平的问题。
这平台面向的群体是各大医院产科诊所的医生，为他们提供一键式服务。
医生使用超声仪器扫描孕妇，采集的超声视频会上传到平台，并调用标准切面抓取程序，得到标准切面图像。接着调用目标检测、分割模型进一步确定各个切面的小结构。医生可以从WebUltrasonic网站中查看到识别结果和统计分析结果。
目前项目组团队共20余人，产品上线推广至300+医院。

#### 消息队列异步化处理是如何实现









## 自我介绍

面试官好，很荣幸来贵公司面试，我叫汪勇圣，目前是湖南大学计算机学院研二的学生，在读期间主要做过两个项目，一个是项目组和医院合作的产前胎儿超声诊断项目，我除了负责骨骼部分的模型训练外，还负责Web系统一部分日常开发工作，像是redis缓存和消息队列这块。另一个项目是自学项目，主要是为了了解RPC的工作原理，做的一个简化版RPC框架，实现了一些最基本的功能。希望能有机会去贵公司进行后端开发实习，我的自我介绍到这里，谢谢。

